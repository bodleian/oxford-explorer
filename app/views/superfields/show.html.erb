<% content_for :title, "#{human_superfield_name(@superfield)}: #{@id} â€“ " %>

<% content_for :structural_nav do %>
  &rarr; <%= link_to human_superfield_name(@superfield), superfield_index_path(@superfield) %>
  &rarr; <%= @id %>
<% end %>

<div class="mapette-container row">
	<div class="twelve columns mapette">
		<a href="/" title="this is fake"><%= image_tag("mapette-placeholder.png", :alt => "this is fake") %></a> (this is fake, and a bit small)
	</div>
</div>

<div class="row">
	<div class="nine columns buffer">
		<h1><%= @id %></h1>
	</div>
	<div class="three columns">

    <% if @things_by_institution.size > 0 %>
      <div style="display:block;">
        <% total = @things_by_institution.map {|x| x.count}.sum %>
        <% @things_by_institution.each do |things_by_institution| %>
          <div style="float:left; width: <%= 100 * (things_by_institution.count.to_f / total.to_f) %>%;" class="inst-<%= things_by_institution.institution_id.downcase %>-bg">&nbsp;</div>
        <% end %>
      </div>
    <% end %>

		<small class="dark">distribution across institutions</small>

	</div>
</div>
<div class="row">
	<div class="nine columns blurb">

		<!--
		This will be quite complex copy that accounts for which superfield you're looking at, and whether or not the related superfields have any links to show here, or not.
		For example...
		-->

		<p>

     		There are about <%= number_with_delimiter(@things_count) %> things about "<%= @id %>" across Oxford.


      <% if @things_by_subjects.size > 0 %>
        They relate to
        <% subject_links = @things_by_subjects.collect do |things_by_subject| %>
          <% link_to(things_by_subject.subject, subject_path(things_by_subject.subject)) %>
        <% end.to_sentence.html_safe %>
        <%= subject_links %>,
      <% end %>

      <% if @min_pubyear && @max_pubyear %>
        and the data we have makes it seem as if they cover a time period like <%= @min_pubyear %> to <%= @max_pubyear %> (but that may well be wrong).
      <% end %>


    </p>

    <% if @things_by_authors.size > 0 %>

      <h6>Related people</h6>
      <p>
        <%= @things_by_authors.collect do |things_by_authors| %>
          <% link_to(things_by_authors.author, person_path(things_by_authors.author)) %>
        <% end.to_sentence(words_connector: '; ',last_word_connector: '; ').html_safe %>
      </p>
    <% end %>

    <% if @things_by_item_type.size > 0 %>

      <h6>Types of thing</h6>
		  <p>
        <%= @things_by_item_type.collect do |thing_by_item_type| %>
          <% link_to(thing_by_item_type.item_type, item_type_path(thing_by_item_type.item_type)) %>
        <% end.to_sentence(words_connector: '; ',last_word_connector: '; ').html_safe %>
      </p>
    <% end %>


		<h4>In <%= pluralize_with_delimiter(@things_in_collections.size, 'collection') %></h4>

		<div class="row">

      <% @things_in_collections.each_with_index
          .partition {|x, i| i.even? }
          .each do |things_in_collections_group| %>

  			<div class="six columns">


          <div class="collection-in-list">
            <ul>
              <% things_in_collections_group.map {|x| x[0] }.each do |things_in_collection| %>

                <% collection = things_in_collection.collection %>
                <li>
                  <%= link_to collection.name, collection_path(collection.id) %>

                  <small><% if things_in_collection.count %><%= number_with_delimiter(things_in_collection.count) %><% else %>some <%end %> of <%= pluralize_with_delimiter(collection.size_int, 'thing') %> at <span class="inst-<%= collection.institution_id.downcase %>"><%= collection.institution_id %></span></small>
                </li>
              <% end %>
            </ul>
          </div>

  			</div>

      <% end %>
    </div>

		<h4><%= pluralize_with_delimiter(@things_count, 'thing') %></h4>

		<ol>

      <% @things.each do |thing| %>
        <li><%= link_to thing.title, thing_path(thing.id), class: 'thing' %></li>
      <% end %>
		</ol>

	</div>
	<div class="three columns">
		<h6>STATS</h6>
		<ul>
			<li><span class="pretend" title="not possible yet">00</span>% of things have metadata online</li>
			<!-- There are no digital metadata records, yet -->

			<li><span class="pretend" title="not possible yet">00</span>% have a digitised version</li>
			<!-- Nothing has a digitised version, yet -->

		</ul>
	</div>

</div>
